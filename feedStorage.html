<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>탐색 페이지</title>
    <link rel="stylesheet" href="./assets/css/feedStorage.css">
</head>
<body>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="검색" onkeyup="searchPosts()">
    </div>

    <div class="grid-container" id="gridContainer">
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="이미지 1">
            <p>세종대왕 폼 미쳤다</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="이미지 2">
            <p>최고다 이순신</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="이미지 3">
            <p>신사임당 그림 보러 가실?</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="이미지 4">
            <p>핫식스 폼 미쳤다</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="이미지 5">
            <p>이순신 살빼서 돌아옴</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="이미지 6">
            <p>당근에 새가방을 싸게 올렸는데 연락이..?</p>
        </div>
    </div>

    <div class="nav-bar">
        <a href="#">🏠</a>
        <a href="#">🔍</a>
        <a href="#">➕</a>
        <a href="#">💬</a>
        <a href="#">👤</a>
    </div>

    <script>
        async function fetchFeeds() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    console.error("로그인 정보가 없습니다. 토큰을 확인하세요.");
                    return;
                }

                const response = await fetch("http://localhost:3000/feed/getFeeds", {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('서버에서 데이터를 불러오는 데 실패했습니다.');
                }

                const data = await response.json();
                console.log(data);  // 데이터 확인

                const feeds = data.data; // 응답에서 data 속성에 있는 피드 배열 가져오기

                if (Array.isArray(feeds)) {
                    renderFeeds(feeds);  // 배열이라면 renderFeeds 호출
                } else {
                    console.error('받은 데이터가 배열이 아닙니다:', feeds);
                }
            } catch (error) {
                console.error("데이터를 불러오는 중 오류 발생:", error);
            }
        }


        function renderFeeds(feeds) {
            const container = document.getElementById("gridContainer");
            container.innerHTML = "";

            feeds.reverse().forEach(feed => {
                const item = document.createElement("div");
                item.classList.add("grid-item");

                item.innerHTML = `
                    <img src="${feed.feed_image}" alt="게시물 이미지">
                    <p>${feed.feed_text}</p>
                `;

                container.appendChild(item);
            });
        }

        function searchPosts() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let items = document.querySelectorAll(".grid-item");

            items.forEach(item => {
                let title = item.querySelector("p").textContent.toLowerCase();
                if (title.includes(input)) {
                    item.classList.remove("hidden");
                } else {
                    item.classList.add("hidden");
                }
            });
        }
        window.onload = function() {
            fetchFeeds();
        };
    </script>

</body>
</html>
