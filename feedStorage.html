<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒìƒ‰ í˜ì´ì§€</title>
    <link rel="stylesheet" href="./assets/css/feedStorage.css">
</head>
<body>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰" onkeyup="searchPosts()">
    </div>

    <div class="grid-container" id="gridContainer">
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="ì´ë¯¸ì§€ 1">
            <p>ì„¸ì¢…ëŒ€ì™• í¼ ë¯¸ì³¤ë‹¤</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="ì´ë¯¸ì§€ 2">
            <p>ìµœê³ ë‹¤ ì´ìˆœì‹ </p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="ì´ë¯¸ì§€ 3">
            <p>ì‹ ì‚¬ì„ë‹¹ ê·¸ë¦¼ ë³´ëŸ¬ ê°€ì‹¤?</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="ì´ë¯¸ì§€ 4">
            <p>í•«ì‹ìŠ¤ í¼ ë¯¸ì³¤ë‹¤</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="ì´ë¯¸ì§€ 5">
            <p>ì´ìˆœì‹  ì‚´ë¹¼ì„œ ëŒì•„ì˜´</p>
        </div>
        <div class="grid-item">
            <img src="./assets/images/00_img.jpeg" alt="ì´ë¯¸ì§€ 6">
            <p>ë‹¹ê·¼ì— ìƒˆê°€ë°©ì„ ì‹¸ê²Œ ì˜¬ë ¸ëŠ”ë° ì—°ë½ì´..?</p>
        </div>
    </div>

    <div class="nav-bar">
        <a href="#">ğŸ </a>
        <a href="#">ğŸ”</a>
        <a href="#">â•</a>
        <a href="#">ğŸ’¬</a>
        <a href="#">ğŸ‘¤</a>
    </div>

    <script>
        async function fetchFeeds() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    console.error("ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. í† í°ì„ í™•ì¸í•˜ì„¸ìš”.");
                    return;
                }

                const response = await fetch("http://localhost:3000/feed/getFeeds", {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const data = await response.json();
                console.log(data);  // ë°ì´í„° í™•ì¸

                const feeds = data.data; // ì‘ë‹µì—ì„œ data ì†ì„±ì— ìˆëŠ” í”¼ë“œ ë°°ì—´ ê°€ì ¸ì˜¤ê¸°

                if (Array.isArray(feeds)) {
                    renderFeeds(feeds);  // ë°°ì—´ì´ë¼ë©´ renderFeeds í˜¸ì¶œ
                } else {
                    console.error('ë°›ì€ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', feeds);
                }
            } catch (error) {
                console.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        }


        function renderFeeds(feeds) {
            const container = document.getElementById("gridContainer");
            container.innerHTML = "";

            feeds.reverse().forEach(feed => {
                const item = document.createElement("div");
                item.classList.add("grid-item");

                item.innerHTML = `
                    <img src="${feed.feed_image}" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€">
                    <p>${feed.feed_text}</p>
                `;

                container.appendChild(item);
            });
        }

        function searchPosts() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let items = document.querySelectorAll(".grid-item");

            items.forEach(item => {
                let title = item.querySelector("p").textContent.toLowerCase();
                if (title.includes(input)) {
                    item.classList.remove("hidden");
                } else {
                    item.classList.add("hidden");
                }
            });
        }
        window.onload = function() {
            fetchFeeds();
        };
    </script>

</body>
</html>
