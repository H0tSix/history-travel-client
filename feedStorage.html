<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íƒìƒ‰ í˜ì´ì§€</title>
    <link rel="stylesheet" href="./assets/css/feedStorage.css" />
  </head>
  <body>
    <div class="search-bar">
      <input
        type="text"
        id="searchInput"
        placeholder="ê²€ìƒ‰"
        onkeyup="searchPosts()"
      />
    </div>

    <div class="grid-container" id="gridContainer"></div>

    <div class="nav-bar">
      <a href="#">ğŸ </a>
      <a href="#">ğŸ”</a>
      <a href="#">â•</a>
      <a href="#">ğŸ’¬</a>
      <a href="#">ğŸ‘¤</a>
    </div>

    <script>
      async function fetchFeeds() {
        try {
          const token = localStorage.getItem("authToken");
          if (!token) {
            console.error("ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. í† í°ì„ í™•ì¸í•˜ì„¸ìš”.");
            return;
          }

          const response = await fetch("http://localhost:3000/feed/getFeeds", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error("ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const data = await response.json();
          const feeds = data.data;

          if (Array.isArray(feeds)) {
            renderFeeds(feeds);
          } else {
            console.error("ë°›ì€ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:", feeds);
          }
        } catch (error) {
          console.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        }
      }

      function renderFeeds(feeds) {
        const container = document.getElementById("gridContainer");
        container.innerHTML = "";

        // ìµœëŒ€ 60ê°œì˜ ê²Œì‹œë¬¼ë§Œ í‘œì‹œ
        const limitedFeeds = feeds.reverse().slice(0, 60);  // ìµœì‹  ê²Œì‹œë¬¼ë¶€í„° 60ê°œë§Œ ì„ íƒ

        limitedFeeds.forEach((feed) => {
            const item = document.createElement("div");
            item.classList.add("grid-item");

            item.innerHTML = `
            <a href="./starFeed.html?fId=${feed.fId}">
                <img src="${feed.imageUrl}" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€">
            </a>
            <p>${feed.feed_text}</p>
            `;

            container.appendChild(item);
        });
      }


      function searchPosts() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let items = document.querySelectorAll(".grid-item");

        items.forEach((item) => {
          let title = item.querySelector("p").textContent.toLowerCase();
          if (title.includes(input)) {
            item.classList.remove("hidden");
          } else {
            item.classList.add("hidden");
          }
        });
      }

      window.onload = function () {
        fetchFeeds();
      };
    </script>
  </body>
</html>
