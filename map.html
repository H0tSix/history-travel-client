<!DOCTYPE html>
<html>

<head>
    <title>Country Map</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2X8KKfHSBUx_GnXnXYQW-DBj1oSkNOZo"></script>
    <style>
        #map {
            height: 100%;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        #year-control {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .year-dropdown {
            position: relative;
            display: inline-block;
        }

        #year-dropdown-btn {
            padding: 8px 16px;
            background: white;
            border: none;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            font-size: 14px;
            min-width: 100px;
        }

        .year-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            max-height: 300px;
            overflow-y: auto;
            margin-top: 5px;
        }

        .year-dropdown-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .year-btn {
            display: block;
            width: 100%;
            padding: 8px 16px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            min-width: 100px;
        }

        .year-btn:hover {
            background: #f0f0f0;
        }

        .year-btn.active {
            background: #833AB4;
            color: white;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes borderGradient {
            0% {
                stroke-dashoffset: 0;
            }

            100% {
                stroke-dashoffset: -100;
            }
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="year-control">
        <div class="year-dropdown">
            <button id="year-dropdown-btn">연도 선택</button>
            <div class="year-dropdown-content">
                <button class="year-btn" data-year="0">0년대</button>
                <button class="year-btn" data-year="100">100년대</button>
                <button class="year-btn" data-year="200">200년대</button>
                <button class="year-btn" data-year="300">300년대</button>
                <button class="year-btn" data-year="400">400년대</button>
                <button class="year-btn" data-year="500">500년대</button>
                <button class="year-btn" data-year="600">600년대</button>
                <button class="year-btn" data-year="700">700년대</button>
                <button class="year-btn" data-year="800">800년대</button>
                <button class="year-btn" data-year="900">900년대</button>
                <button class="year-btn" data-year="1000">1000년대</button>
                <button class="year-btn" data-year="1100">1100년대</button>
                <button class="year-btn" data-year="1200">1200년대</button>
                <button class="year-btn" data-year="1300">1300년대</button>
                <button class="year-btn" data-year="1400">1400년대</button>
                <button class="year-btn" data-year="1500">1500년대</button>
                <button class="year-btn" data-year="1600">1600년대</button>
                <button class="year-btn" data-year="1700">1700년대</button>
                <button class="year-btn" data-year="1800">1800년대</button>
                <button class="year-btn" data-year="1900">1900년대</button>
                <button class="year-btn active" data-year="2000">2000년대</button>
            </div>
        </div>
    </div>
    <div id="info">선택된 국가: <span id="selected-country">없음</span></div>

    <script>
        let map;
        let selectedPolygon = null;
        let countryPolygons = new Map();

        async function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 4,
                center: { lat: 41.9028, lng: 12.4964 },
                mapTypeControl: false
            });

            try {
                const response = await fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson');
                const data = await response.json();

                data.features.forEach(feature => {
                    const countryName = feature.properties.ADMIN;
                    const polygons = [];

                    if (feature.geometry.type === 'Polygon') {
                        const paths = feature.geometry.coordinates[0].map(c => ({
                            lat: c[1],
                            lng: c[0]
                        }));
                        createPolygon(paths, countryName, polygons);
                    } else if (feature.geometry.type === 'MultiPolygon') {
                        feature.geometry.coordinates.forEach(coord => {
                            const paths = coord[0].map(c => ({
                                lat: c[1],
                                lng: c[0]
                            }));
                            createPolygon(paths, countryName, polygons);
                        });
                    }

                    countryPolygons.set(countryName, polygons);
                });
            } catch (error) {
                console.error('Error loading GeoJSON:', error);
            }
        }

        function createPolygon(paths, countryName, polygons) {
            const polygon = new google.maps.Polygon({
                paths: paths,
                strokeColor: '#808080',
                strokeOpacity: 0.8,
                strokeWeight: 1,
                fillColor: '#FFFFFF',
                fillOpacity: 0.35,
                map: map
            });

            polygons.push(polygon);

            // 마우스 오버 효과
            google.maps.event.addListener(polygon, 'mouseover', function () {
                if (selectedPolygon !== countryName) {
                    countryPolygons.get(countryName).forEach(p => {
                        p.setOptions({
                            strokeColor: '#404040',
                            strokeWeight: 2,
                            fillColor: '#808080',
                            fillOpacity: 0.3
                        });
                    });
                }
            });

            // 마우스 아웃 효과
            google.maps.event.addListener(polygon, 'mouseout', function () {
                if (selectedPolygon !== countryName) {
                    countryPolygons.get(countryName).forEach(p => {
                        p.setOptions({
                            strokeColor: '#808080',
                            strokeWeight: 1,
                            fillColor: '#FFFFFF',
                            fillOpacity: 0.35
                        });
                    });
                }
            });

            // 클릭 효과
            google.maps.event.addListener(polygon, 'click', function () {
                if (selectedPolygon) {
                    countryPolygons.get(selectedPolygon).forEach(p => {
                        p.setOptions({
                            strokeColor: '#808080',
                            strokeWeight: 1,
                            fillColor: '#FFFFFF',
                            fillOpacity: 0.35
                        });
                    });
                }

                countryPolygons.get(countryName).forEach(p => {
                    const animateStroke = () => {
                        p.setOptions({
                            strokeColor: '#833AB4',
                            strokeWeight: 3,
                            fillColor: '#FCB045',
                            fillOpacity: 0.15
                        });
                    };

                    animateStroke();
                });

                selectedPolygon = countryName;
                document.getElementById('selected-country').textContent = countryName;
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const dropdownBtn = document.getElementById('year-dropdown-btn');
            const dropdownContent = document.querySelector('.year-dropdown-content');

            // 드롭다운 버튼 클릭 이벤트
            dropdownBtn.addEventListener('click', function () {
                dropdownContent.classList.toggle('show');
            });

            // 연도 선택 이벤트
            document.querySelectorAll('.year-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.year-btn').forEach(b =>
                        b.classList.remove('active')
                    );
                    this.classList.add('active');
                    dropdownBtn.textContent = this.textContent;
                    dropdownContent.classList.remove('show');
                    const selectedYear = this.dataset.year;
                    console.log('Selected year:', selectedYear);
                });
            });

            // 드롭다운 외부 클릭 시 닫기
            document.addEventListener('click', function (event) {
                if (!event.target.matches('#year-dropdown-btn') && !event.target.matches('.year-btn')) {
                    dropdownContent.classList.remove('show');
                }
            });
        });

        initMap();
    </script>
</body>

</html>